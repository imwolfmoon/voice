<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Ú¯ÙØªØ§Ø± Ø¨Ù‡ Ù…ØªÙ† Ø¯Ø± TinyMCE</title>
  <script src="https://cdn.tiny.cloud/1/no-api-key/tinymce/6/tinymce.min.js" referrerpolicy="origin"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen">

  <textarea id="editor">Ù…ØªÙ† Ø®ÙˆØ¯ Ø±Ø§ Ø§ÛŒÙ†Ø¬Ø§ Ø¨Ù†ÙˆÛŒØ³ÛŒØ¯...</textarea>

  <script>
    tinymce.init({
      selector: '#editor',
      directionality: 'rtl',
      language: 'fa',
      height: 500,
      menubar: false,
      plugins: 'code',
      toolbar: 'undo redo | bold italic underline | speech | code',

      setup: function (editor) {
        editor.ui.registry.addButton('speech', {
          text: 'ğŸ¤ Ú¯ÙØªØ§Ø±',
          onAction: function () {
            // Ø³Ø§Ø®Øª Ù¾Ù†Ø¬Ø±Ù‡ Ø§Ù†ØªØ®Ø§Ø¨ Ø²Ø¨Ø§Ù† Ùˆ Ø¯Ú©Ù…Ù‡ Ø§Ø³ØªØ§Ø±Øª
            const dialog = document.createElement('div');
            dialog.className = "fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50";

            dialog.innerHTML = `
              <div class="bg-white p-6 rounded-xl shadow-xl w-full max-w-md text-right">
                <h2 class="text-xl font-bold text-red-600 mb-4">ğŸ™ï¸ ØªØ¨Ø¯ÛŒÙ„ Ú¯ÙØªØ§Ø± Ø¨Ù‡ Ù…ØªÙ†</h2>
                <label class="block font-semibold mb-2">Ø§Ù†ØªØ®Ø§Ø¨ Ø²Ø¨Ø§Ù†:</label>
                <select id="speechLang" class="w-full mb-4 p-2 border border-gray-300 rounded">
                  <option value="fa-IR">ÙØ§Ø±Ø³ÛŒ</option>
                  <option value="en-US">Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ</option>
                  <option value="ar-SA">Ø¹Ø±Ø¨ÛŒ</option>
                  <option value="tr-TR">ØªØ±Ú©ÛŒ Ø§Ø³ØªØ§Ù†Ø¨ÙˆÙ„ÛŒ</option>
                  <option value="fr-FR">ÙØ±Ø§Ù†Ø³ÙˆÛŒ</option>
                </select>
                <div class="flex justify-between mt-4">
                  <button id="startSpeech" class="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700">ğŸ™ï¸ Ø´Ø±ÙˆØ¹</button>
                  <button id="closeSpeech" class="bg-gray-300 text-gray-800 px-4 py-2 rounded hover:bg-gray-400">Ø¨Ø³ØªÙ†</button>
                </div>
              </div>
            `;
            document.body.appendChild(dialog);

            let recognition;
            let recognizing = false;

            function createRecognition(lang) {
              const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
              const r = new SpeechRecognition();
              r.lang = lang;
              r.continuous = true;
              r.interimResults = false;

              r.onresult = (event) => {
                let transcript = "";
                for (let i = event.resultIndex; i < event.results.length; ++i) {
                  if (event.results[i].isFinal) {
                    transcript += event.results[i][0].transcript + " ";
                  }
                }
                editor.insertContent(transcript);
              };

              r.onerror = (event) => {
                console.error("Ø®Ø·Ø§:", event.error);
              };

              r.onend = () => {
                if (recognizing) r.start();
              };

              return r;
            }

            document.getElementById("startSpeech").addEventListener("click", () => {
              const lang = document.getElementById("speechLang").value;

              if (!recognition) recognition = createRecognition(lang);

              if (recognizing) {
                recognition.stop();
                recognizing = false;
                document.getElementById("startSpeech").textContent = "ğŸ™ï¸ Ø´Ø±ÙˆØ¹";
              } else {
                recognition = createRecognition(lang); // Ø¨Ø§ Ø²Ø¨Ø§Ù† Ø¬Ø¯ÛŒØ¯
                recognition.start();
                recognizing = true;
                document.getElementById("startSpeech").textContent = "â¹ï¸ ØªÙˆÙ‚Ù";
              }
            });

            document.getElementById("closeSpeech").addEventListener("click", () => {
              if (recognizing && recognition) {
                recognition.stop();
              }
              dialog.remove();
            });
          }
        });
      }
    });
  </script>
</body>
</html>
